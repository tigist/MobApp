<!DOCTYPE HTML>
<html>
<meta charset="UTF-8">
<head>
<title>BRIDGE Mob agent demo</title>
<style type="text/css">
      .button
	      {
	      background: Image/refresh.png; 
	      cursor:pointer;
	                  border: none;
	      }
</style>

<link type="text/css" href="css/smoothness/jquery-ui-1.8.23.custom.css" rel="Stylesheet" />	
<script type="text/javascript" charset="utf-8" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.23.custom.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery.rest.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery.json-2.3.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/cordova-1.8.0.js"></script>
<script type="text/javascript" charset="utf-8" src="js/SystemNotification.js"></script>
<script type="text/javascript" charset="utf-8" src="js/renderer2.js"></script>
<script type="text/javascript" charset="utf-8" src="js/askREST_cache.js"></script>

<script type="text/javascript" charset="utf-8">
 
	$(function() {
		$( "#tabs" ).tabs();
		
	});
</script>
	
<script type="text/javascript" charset="utf-8">

function notification() {    				
    document.addEventListener('deviceready', onDeviceReady ,false);
}

function onDeviceReady(){	
	console.log("device is ready");
	  
	window.plugins.PaigeSystemNotification.createStatusBarNotification("Title","Notification","Alert"); 
	//window.plugins.webView.sendAppToFront();
	navigator.geolocation.getCurrentPosition(onSuccess, onError);
	}
 function appFront(){
	 //setTimeout(function(){
		 window.plugins.PaigeSystemNotification.updateNotification("Title","Notification","Alert"); 
	
		 window.plugins.webView.sendAppToFront();
		// },10000);
 }
 function onSuccess(position) {
	 var lat = position.coords.latitude;
	 var lon =  position.coords.longitude;	 
	 console.log(position.coords.latitude + "-" + position.coords.longitude);
	 alert("u r located at + (" + lat + " ,  " + lon + ")");
 }
 

function onError(error) {	
      alert('code: '    + error.code     +      
     'message: ' + error.message + '\n');  
	  }

//setupCache for task
var setupCache = function() { 
	var j = document.getElementById('login').value;	
 	var uuid = identifier(j,agents);
		 console.log("uuid = " + uuid);
	 if(!caches.exists("label")) {
		 alert("Application started")
		 console.log("Init Cache label");	
		 cache = new ASKCache("label", "agent/" + uuid + "/tasks" ,null,"id",session,false);//for task 
		 cache.addRenderer('all', my_renderer);	
         cache.onChangeCBs[cache.onChangeCBs.length]=
        	 function(a,b){console.log(a,b);
        		 if(a !== null && (JSON.stringify(a) !== JSON.stringify(b))){
        			notification();//repeat the notification sound         			
					appFront(); //onchange only app to front
					//alert("there is an update");
				}
        	 };
         cache.render(); 
         
	}else{
        	 alert("Loading information ...");
             cache.addRenderer('all', my_renderer);           
             cache.onChangeCBs[cache.onChangeCBs.length]=
            	 function(a,b){console.log(a,b);
            		 if(a !== null && (JSON.stringify(a) !== JSON.stringify(b)) ){
            			notification();//repeat the notification sound         			
    					appFront(); //onchange only app to front
    					//alert("there is an update");
    			}
           };
            	// cache.render(); //???
     }
} 

//setupCache for agent
var setupCacheAgent = function() { 	
	 if(!caches.exists("agentCache")) {
		 console.log("Init Cache agent");	
		 cache = new ASKCache("agentCache","agent/",null,"uuid",session,true); // cache for agents
		 cache.addRenderer("all", agent_renderer);
	 }
}
var okClick = function(){	
	var pin = document.getElementById('login').value;
	if(pin == ""){
		alert("Please enter your pin code");
		}else{
		var start = document.getElementById('start');
		start.disabled= false;
		setupCacheAgent();	
		var msg = document.getElementById('msg');		
		msg.innerHTML="You are logged in successfully! <br> Now you can start the application to<br>see the incoming and operational task"
		}
	}
</script>
</head>
<body onLoad = notification();>
 
<div class="Bridge-demo">

<div id="tabs" style="font-size:medium;">
	<ul>
		<li id='li0'><a href="#tabs-0">Login</a></li>
		<li id='li1'><a href="#tabs-1">Incoming</a></li>
		<li id='li2'><a href="#tabs-2">Operational</a></li>		
	</ul>
	
	<div id="tabs-0">
		
			Pin :
			<input type="text" id="login"  size="4">
			<input type = "button" id="btnOk"  value ="ok" onclick = "okClick();" >	
			<input type="image" src="Image/refresh.png"  align="right"  width="48 height="48" onClick="history.go(0);" /><br>
			
		
		<span id = "msg"></span>
	</div>	
	
	<div id="tabs-1">
		<input type = "button" id="start" onclick = "setupCache();" value ="start" disabled="disabled">		
		
		<input type="image" src="Image/refresh.png"  align="right"  width="48 height="48" onClick="history.go(0);" />
		
		<ul id = "selectable"></ul>
	</div>
	
	<div id="tabs-2">
	Oprational tasks: 
		<input type="image" src="Image/refresh.png"  align="right"  width="48 height="48" onClick="history.go(0);" />
		<ul id = "selectable1"></ul>
	</div>	
</div>
</div>	
</body>
</html>
